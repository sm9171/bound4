= Bound4 Project Management API 문서
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toc: left
:toclevels: 3
:sectlinks:

[[overview]]
== 개요

이 문서는 헥사고날 아키텍처 기반으로 구현된 RBAC(Role-Based Access Control) 시스템을 가진 프로젝트 관리 API에 대한 명세서입니다.

=== 주요 기능

* JWT 기반 사용자 인증 및 인가
* 역할 기반 접근 제어 (RBAC)
* 구독 플랜별 기능 제한
* 프로젝트 생성, 수정, 삭제, 조회
* 관리자 전용 정책 관리
* 실시간 권한 업데이트 및 감사 로그

=== 아키텍처

* **Hexagonal Architecture**: 포트와 어댑터 패턴으로 비즈니스 로직과 외부 시스템 분리
* **Domain Driven Design**: 풍부한 도메인 모델과 비즈니스 로직 중심 설계
* **Event-Driven**: 권한 변경 시 실시간 알림 및 감사 로그 생성

[[http-verbs]]
== HTTP 동사

본 REST API에서 사용하는 HTTP 동사는 다음과 같습니다.

|===
| 동사 | 용도

| `GET`
| 리소스를 가져올 때 사용

| `POST`
| 새 리소스를 만들 때 사용

| `PUT`
| 기존 리소스를 수정할 때 사용

| `DELETE`
| 기존 리소스를 삭제할 때 사용
|===

[[http-status-codes]]
== HTTP 상태 코드

본 REST API에서 사용하는 HTTP 상태 코드는 다음과 같습니다.

|===
| 상태 코드 | 용도

| `200 OK`
| 요청을 성공적으로 처리함

| `201 Created`
| 새 리소스를 성공적으로 생성함

| `204 No Content`
| 요청을 성공적으로 처리했지만 반환할 콘텐츠가 없음

| `400 Bad Request`
| 잘못된 요청

| `401 Unauthorized`
| 인증이 필요함

| `403 Forbidden`
| 권한이 없음

| `404 Not Found`
| 요청한 리소스가 없음

| `409 Conflict`
| 중복된 리소스 또는 비즈니스 규칙 위반

| `500 Internal Server Error`
| 서버 내부 오류
|===

[[authentication]]
== 인증 및 인가

[[auth-register]]
=== 회원가입

사용자가 새 계정을 생성합니다.

==== 성공 응답

operation::register[snippets='request-fields,response-fields,http-request,http-response']

==== 이메일 중복 오류

operation::register_DuplicateEmail[snippets='request-fields,response-fields,http-request,http-response']

==== 유효성 검사 오류

operation::register_ValidationError[snippets='request-fields,response-fields,http-request,http-response']

[[auth-login]]
=== 로그인

사용자 인증을 통해 JWT 토큰을 발급받습니다.

==== 성공 응답

operation::login[snippets='request-fields,response-fields,http-request,http-response']

==== 인증 실패

operation::login_InvalidCredentials[snippets='request-fields,response-fields,http-request,http-response']

[[auth-refresh]]
=== 토큰 갱신

리프레시 토큰을 사용하여 새로운 액세스 토큰을 발급받습니다.

==== 성공 응답

operation::refreshToken[snippets='request-fields,response-fields,http-request,http-response']

==== 토큰 만료 오류

operation::refreshToken_ExpiredToken[snippets='request-fields,response-fields,http-request,http-response']

[[auth-logout]]
=== 로그아웃

사용자 세션을 종료하고 토큰을 무효화합니다.

operation::logout[snippets='request-headers,response-fields,http-request,http-response']

[[auth-me]]
=== 사용자 정보 조회

현재 로그인한 사용자의 정보를 조회합니다.

operation::getUserInfo[snippets='request-headers,response-fields,http-request,http-response']

[[projects]]
== 프로젝트 API

[[projects-create]]
=== 프로젝트 생성

새로운 프로젝트를 생성합니다. 구독 플랜에 따라 생성 가능한 프로젝트 수가 제한됩니다.

* **BASIC 플랜**: 최대 1개 프로젝트
* **PRO 플랜**: 최대 5개 프로젝트

==== 성공 응답

operation::createProject[snippets='request-headers,request-fields,response-fields,http-request,http-response']

==== 유효성 검사 오류

operation::createProject_ValidationError[snippets='request-headers,request-fields,response-fields,http-request,http-response']

[[projects-get]]
=== 프로젝트 조회

특정 프로젝트의 상세 정보를 조회합니다.

==== 성공 응답

operation::getProject[snippets='request-headers,path-parameters,response-fields,http-request,http-response']

==== 권한 없음 오류

operation::getProject_Forbidden[snippets='request-headers,path-parameters,response-fields,http-request,http-response']

[[projects-list]]
=== 프로젝트 목록 조회

사용자의 프로젝트 목록을 페이지네이션으로 조회합니다.

==== 기본 조회

operation::getProjects[snippets='request-headers,query-parameters,response-fields,http-request,http-response']

[[projects-update]]
=== 프로젝트 수정

기존 프로젝트의 정보를 수정합니다.

==== 성공 응답

operation::updateProject[snippets='request-headers,path-parameters,request-fields,response-fields,http-request,http-response']

[[projects-delete]]
=== 프로젝트 삭제

프로젝트를 삭제합니다. 실제로는 상태를 ARCHIVED로 변경하는 소프트 삭제가 수행됩니다.

operation::deleteProject[snippets='request-headers,path-parameters,http-request,http-response']

[[projects-count]]
=== 활성 프로젝트 개수 조회

사용자의 활성 프로젝트 개수를 조회합니다.

operation::getActiveProjectCount[snippets='request-headers,response-fields,http-request,http-response']

[[admin]]
== 관리자 API

관리자(A 역할) 전용 API로, 시스템 전체의 권한 정책을 관리할 수 있습니다.

[[admin-policies]]
=== 역할 정책 조회

현재 설정된 모든 역할 정책을 조회합니다.

==== 성공 응답

operation::getRolePolicies[snippets='request-headers,response-fields,http-request,http-response']

==== 권한 없음 오류

operation::getRolePolicies_Forbidden[snippets='request-headers,response-fields,http-request,http-response']

[[admin-policies-update]]
=== 역할 정책 수정

특정 역할의 권한 정책을 수정합니다. 시스템 정책은 수정할 수 없습니다.

==== 성공 응답

operation::updateRolePolicy[snippets='request-headers,request-fields,response-fields,http-request,http-response']

==== 시스템 정책 수정 오류

operation::updateRolePolicy_SystemPolicyError[snippets='request-headers,request-fields,response-fields,http-request,http-response']

[[admin-user-permissions]]
=== 사용자 권한 조회

특정 사용자의 권한 정보를 상세히 조회합니다.

operation::getUserPermissions[snippets='request-headers,path-parameters,response-fields,http-request,http-response']

[[admin-user-role]]
=== 사용자 역할 변경

사용자의 역할을 변경합니다. 변경 시 감사 로그가 생성되고 해당 사용자에게 알림이 전송됩니다.

operation::updateUserRole[snippets='request-headers,path-parameters,request-fields,response-fields,http-request,http-response']

[[admin-backup]]
=== 정책 백업 생성

현재 권한 정책의 백업을 생성합니다.

operation::createPolicyBackup[snippets='request-headers,response-fields,http-request,http-response']

[[admin-restore]]
=== 정책 백업 복원

이전에 생성한 백업으로부터 정책을 복원합니다.

operation::restorePolicyBackup[snippets='request-headers,path-parameters,response-fields,http-request,http-response']

[[rbac-system]]
== RBAC 시스템

=== 사용자 역할

|===
| 역할 | 설명 | 권한

| `A` (관리자)
| 시스템 관리자
| 모든 리소스에 대한 전체 권한

| `B` (프리미엄)
| 프리미엄 사용자
| 프로젝트 생성, 수정, 삭제, 다른 사용자 프로젝트 읽기 권한

| `C` (표준)
| 표준 사용자
| 본인 프로젝트 생성, 수정, 읽기 권한

| `D` (기본)
| 기본 사용자
| 본인 프로젝트 읽기 권한만 가능
|===

=== 구독 플랜

|===
| 플랜 | 최대 프로젝트 수 | 추가 기능

| `BASIC`
| 1개
| 기본 기능

| `PRO`
| 5개
| 고급 기능, 다른 사용자 프로젝트 접근
|===

=== 권한 매트릭스

|===
| 리소스/액션 | A (관리자) | B (프리미엄) | C (표준) | D (기본)

| PROJECT:CREATE
| ✓
| ✓
| ✓
| ✗

| PROJECT:READ
| ✓
| ✓
| ✓
| ✓

| PROJECT:UPDATE
| ✓
| ✓
| ✓ (본인만)
| ✗

| PROJECT:DELETE
| ✓
| ✓
| ✗
| ✗

| USER:READ
| ✓
| ✓ (제한적)
| ✗
| ✗

| USER:MANAGE
| ✓
| ✗
| ✗
| ✗

| SYSTEM:MANAGE
| ✓
| ✗
| ✗
| ✗

| ROLE_POLICY:MANAGE
| ✓
| ✗
| ✗
| ✗
|===

[[error-handling]]
== 오류 처리

=== 일반적인 오류 응답 형식

모든 오류 응답은 다음과 같은 형식을 따릅니다:

[source,json]
----
{
  "success": false,
  "error": "ERROR_CODE",
  "message": "오류 메시지",
  "timestamp": "2024-11-24T10:30:00Z"
}
----

=== 인증 오류

|===
| HTTP 상태 | 오류 메시지 | 설명

| `401 Unauthorized`
| "인증이 필요합니다."
| JWT 토큰이 없거나 유효하지 않음

| `401 Unauthorized`
| "만료된 토큰입니다."
| JWT 토큰이 만료됨

| `401 Unauthorized`
| "잘못된 토큰 형식입니다."
| JWT 토큰 형식이 올바르지 않음
|===

=== 권한 오류

|===
| HTTP 상태 | 오류 메시지 | 설명

| `403 Forbidden`
| "권한이 없습니다."
| 해당 리소스에 대한 접근 권한 없음

| `403 Forbidden`
| "관리자 권한이 필요합니다."
| 관리자 전용 기능에 일반 사용자가 접근

| `403 Forbidden`
| "{PLAN} 플랜 이상이 필요합니다."
| 구독 플랜이 요구사항에 미치지 못함

| `403 Forbidden`
| "최대 {count}개의 프로젝트만 생성할 수 있습니다."
| 구독 플랜의 프로젝트 생성 제한 초과
|===

=== 비즈니스 로직 오류

|===
| HTTP 상태 | 오류 메시지 | 설명

| `400 Bad Request`
| "이미 존재하는 이메일입니다."
| 회원가입 시 이메일 중복

| `400 Bad Request`
| "같은 이름의 프로젝트가 이미 존재합니다."
| 프로젝트 이름 중복

| `400 Bad Request`
| "시스템 정책은 수정할 수 없습니다."
| 시스템 보호 정책 수정 시도

| `400 Bad Request`
| "이미 동일한 역할입니다."
| 동일한 역할로 변경 시도

| `404 Not Found`
| "사용자를 찾을 수 없습니다."
| 존재하지 않는 사용자 ID

| `404 Not Found`
| "프로젝트를 찾을 수 없습니다."
| 존재하지 않는 프로젝트 ID

| `404 Not Found`
| "백업을 찾을 수 없습니다."
| 존재하지 않는 백업 ID
|===

[[security]]
== 보안

=== JWT 토큰

* **알고리즘**: HS256
* **액세스 토큰 만료**: 1시간
* **리프레시 토큰 만료**: 7일
* **토큰 구성**: Header.Payload.Signature

=== 토큰 페이로드

[source,json]
----
{
  "sub": "user@example.com",
  "userId": 1,
  "role": "ROLE_C",
  "subscriptionPlan": "PLAN_BASIC",
  "iat": 1700000000,
  "exp": 1700003600
}
----

=== 보안 헤더

모든 응답에는 다음 보안 헤더가 포함됩니다:

* `X-Content-Type-Options: nosniff`
* `X-Frame-Options: DENY`
* `X-XSS-Protection: 0`
* `Referrer-Policy: strict-origin-when-cross-origin`

=== CORS 설정

* **허용 Origin**: `http://localhost:3000`, `https://bound4.com`
* **허용 Methods**: `GET`, `POST`, `PUT`, `DELETE`, `OPTIONS`
* **허용 Headers**: 모든 헤더
* **Credentials**: 허용

[[request-response-format]]
== 요청/응답 형식

=== Content-Type

* **요청**: `application/json`
* **응답**: `application/json`

=== 인증 헤더

모든 보호된 엔드포인트는 다음 헤더가 필요합니다:

[source,http]
----
Authorization: Bearer {jwt_token}
----

=== 표준 응답 형식

모든 API 응답은 다음과 같은 표준 형식을 따릅니다:

==== 성공 응답

[source,json]
----
{
  "success": true,
  "data": {
    // 실제 데이터
  },
  "message": null,
  "timestamp": "2024-11-24T10:30:00Z"
}
----

==== 오류 응답

[source,json]
----
{
  "success": false,
  "error": "ERROR_CODE",
  "message": "오류 메시지",
  "timestamp": "2024-11-24T10:30:00Z"
}
----

=== 페이지네이션

목록 조회 API는 Spring Data의 `Page` 인터페이스를 사용합니다:

[source,json]
----
{
  "success": true,
  "data": {
    "content": [
      // 실제 데이터 배열
    ],
    "pageable": {
      "sort": {
        "empty": false,
        "sorted": true,
        "unsorted": false
      },
      "offset": 0,
      "pageSize": 10,
      "pageNumber": 0,
      "paged": true,
      "unpaged": false
    },
    "totalPages": 5,
    "totalElements": 50,
    "last": false,
    "size": 10,
    "number": 0,
    "sort": {
      "empty": false,
      "sorted": true,
      "unsorted": false
    },
    "numberOfElements": 10,
    "first": true,
    "empty": false
  },
  "message": null,
  "timestamp": "2024-11-24T10:30:00Z"
}
----

[[api-versioning]]
== API 버전 관리

현재 API 버전: `v1`

모든 API 엔드포인트는 `/api/` 접두사를 사용합니다.

향후 버전 업그레이드 시에는 `/api/v2/` 형식으로 네임스페이스를 분리할 예정입니다.

[[rate-limiting]]
== Rate Limiting

현재 구현되지 않았지만, 향후 다음과 같은 제한을 계획하고 있습니다:

* **일반 사용자**: 분당 100회 요청
* **프리미엄 사용자**: 분당 200회 요청
* **관리자**: 제한 없음

[[monitoring]]
== 모니터링 및 감사

=== 감사 로그

모든 중요한 작업은 감사 로그로 기록됩니다:

* 사용자 역할 변경
* 권한 정책 수정
* 프로젝트 생성/삭제
* 로그인/로그아웃

=== 로그 형식

[source,json]
----
{
  "id": 1,
  "adminUserId": 1,
  "adminEmail": "admin@example.com",
  "targetUserId": 2,
  "targetEmail": "user@example.com",
  "actionType": "USER_ROLE_CHANGE",
  "description": "사용자 역할을 C에서 B로 변경",
  "reason": "우수한 성과로 인한 승급",
  "createdAt": "2024-11-24T10:30:00Z"
}
----